
<h3>OpenID Connect Provider</h3>
<p>The implementation uses Authorization Code Grant Flow with PKCE. A public client has to be used when setting up the provider.</p>

<h4>OpenID Connect with ADFS</h4>
<p>To setup SSO with ADFS do the following. Some ADFS setups are known to return "invalid_grant" errors.   
If this is the case for you, try using another SSO connection like SAML.
</p>
<ol>
	<li><strong>Open ADFS:&nbsp;</strong>Connect to you ADFS Server and open the AD FS Management Tool.</li>
	<li><strong>Add Application Group:&nbsp;</strong>Right Click 'Application Groups' and choose 'Add Application Group...'.</li>
	<li><strong>Web Access:&nbsp;</strong>Enter a Name and choose "Web Browser accessing a web application". Click Next.</li>
	<li><strong>Redirect URI:&nbsp;</strong>Add the redirect URI:
		<ul>
			<li><strong>Template:&nbsp;</strong>https://&lt;yourserver:port&gt;/sso/callback/openidconnect</li>
			<li><strong>&lt;yourserver:port&gt;:&nbsp;</strong>Replace with servername and port as used by the end user.</li>
		</ul>
	</li>
	<li><strong>Copy Client ID:&nbsp;</strong>Copy the ClientID that you see on this section of the wizard. You will need it later in the setup.</li>
	<li><strong>Access Control Policy:&nbsp;</strong>Choose the access control policy you want to set. Click Next and complete this wizard.</li>
	<li><strong>Client Permissions:&nbsp;</strong>
		<ul>
			<li>Double Click the application group you have created.</li>
			<li>Double click the web application in the list.</li>
			<li>Change to the tab "Client Permissions".</li>
			<li>Select the scopes 'openid, profile, email, allatclaims' and click 'Apply'.</li>
		</ul>
	</li>
	<li><strong>Issuance Transform Rules:&nbsp;</strong>
		<ul>
			<li>Change to the tab "Issuance Transform Rules" and click 'Add Rule...'.</li>
			<li>Choose "Send LDAP Attributes as Claims" and click Next.</li>
			<li>Add a name, choose the attribute store and add the following mappings:
				<ul>
					<li><strong>User-Principal-Name:&nbsp;</strong>upn</li>
					<li><strong>Email-Addresses:&nbsp;</strong>email</li>
					<li><strong>Given-Name:&nbsp;</strong>given_name</li>
					<li><strong>Surename:&nbsp;</strong>family_name</li>
					
				</ul>
			</li>
			<li>Click 'Finish'.</li>
		</ul>
	</li>
	<li><strong>Open EMP:&nbsp;</strong>Open EMP and go to "Menu &gt;&gt; Admin &gt;&gt; Context Settings".</li>
	<li><strong>Add Provider:&nbsp;</strong>Click on "Add >> OpenID Connect Provider" to add a new provider.</li>
	<li><strong>Required Settings for the Provider:&nbsp;</strong>
		<ul>
			<li><strong>Name:&nbsp;</strong>Name for this SSO Connection. Will be added as a button in the login page.</li>
			<li><strong>Well Known Path:&nbsp;</strong>URL to the well-known config of your server.(e.g. https://acme.youradfsserver.com/adfs/.well-known/openid-configuration)</li>
			<li><strong>Client ID:&nbsp;</strong>The Client ID that you copied in a previous step. You can retrieve this from the properties of your application.</li>
			<li><strong>Resource:&nbsp;</strong>By default this is also the ClientID. You can find this under "Your Application Group >> Web Application >> Identifiers >> Relying Party Identifiers".</li>
			<li><strong>Additional Scope:&nbsp;</strong> Enter "allatclaims".</li>
		</ul>
	</li>
	<li><strong>Finish Setup:&nbsp;</strong>Click on "Add" to add the new provider.</li>
	<li><strong>Test:&nbsp;</strong>Open a new incognito window in your browser, open the start page and check if a single-sign-on button is present. Test the login by using the button.</li>
</ol>




