
<p>
	This cheat sheet gives you a quick introduction to the concepts of the query language and how to use it.
</p>

<!-- ============================================================ -->
<!-- CONCEPTS -->
<!-- ============================================================ -->
<h2>Concepts</h2>

<!-- =========================== FIRST ROW ================================= -->
<div class="d-flex flex-row page-break-avoid">

	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Queries</div>
		</div>
		<div class="card-body maxvw-40">
			Queries are a combination of one or multiple commands chained together with the pipe "|" symbol.
			Multiple queries can be combined together by using semicolon ";" to terminate one query and start a new one. 
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Commands</div>
		</div>
		<div class="card-body maxvw-40">
			Commands are used to fetch and process data.
			The most important command is 'source', as it is the one bringing data into your query.
			Commands can have aliases, for example instead of 'source', you can as well use 'src'.
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Sources</div>
		</div>
		<div class="card-body maxvw-40">
			Sources are data provider from which the queries are getting their data.
			The 'source' command is used to choose one of these sources. For example 
			you can choose the source 'random' which will give you randomized test data:
			<pre><code class="language-cfwquery">source random records=100</code></pre>
		</div>
	</div>
	
</div>

<!-- =========================== SECOND ROW ================================= -->

<div class="d-flex flex-row page-break-avoid">

	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Record</div>
		</div>
		<div class="card-body maxvw-40">
			A set of data that relates to the same thing is considered a record.
			A record could be the personal data of a human being or the properties of a host.
			In the table view, a record is represented as a row of the table.
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Fields</div>
		</div>
		<div class="card-body maxvw-40">
			A field is a single property of a record.
			For example the firstname and lastname of a person are fields of a record.
			A field has a fieldname and a field value. Fieldnames are used in queries
			to select the fields to filter by or to which data should be manipulated.
			Fieldnames are case sensitive.
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Timerange</div>
		</div>
		<div class="card-body maxvw-40">
			A time range selector is available to specify the time to fetch data from the source.
			It depends on the source if time is actually used and how it is applied. Check the
			documentation for the  source you are using or use the content assist.
		</div>
	</div>
</div>


<!-- =========================== THIRD ROW ================================= -->

<div class="d-flex flex-row page-break-avoid">

	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>In-Memory Processing</div>
		</div>
		<div class="card-body maxvw-40">
			All the data fetched by the query is processed in the memory and is returned to the client once all data is processed.
			Therefore queries can be memory intensive. Therefore there are limits on how many data can be processed.
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Limits</div>
		</div>
		<div class="card-body maxvw-40">
			The limits are set by the system administrator. 
			There is a default and maximum fetch limit on the number of records processed per source.
			You can change the default limit on the source command using the parameter 'limit':
			<pre><code class="language-cfwquery">| source random 
	records=50000 
	limit=100000</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>CPU Intensive</div>
		</div>
		<div class="card-body maxvw-40">
			As commands are chained together and executed in parallel, as more commands a query has the more threads are started and as higher it's CPU usage.
		</div>
	</div>
	
</div>

<!-- ============================================================ -->
<!-- QUERY BASICS -->
<!-- ============================================================ -->
<h2>Query Basics</h2>

<!-- =========================== FIRST ROW ================================= -->
<div class="d-flex flex-row page-break-avoid">

	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Content Assist</div>
		</div>
		<div class="card-body maxvw-40">
			When entering a query, use the keyboard shortcut 
			<span class="badge badge-primary">CTRL</span> + <span class="badge badge-primary">Spacebar</span> 
			to get some help at the cursor position. For example, entering "| di" and using content assist will give you a list of all commands containing "di".
			Using the shortcut after "| source" will give you a list of available sources.
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Fast Edit and Execute</div>
		</div>
		<div class="card-body maxvw-40">
			With the shortcut
			<span class="badge badge-primary">CTRL</span> + <span class="badge badge-primary">Enter</span> 
			you can execute a query.
			Using the shortcut 
			<span class="badge badge-primary">CTRL</span> + <span class="badge badge-primary">Up</span>/<span class="badge badge-primary">Down</span>
			you can copy the current line or the selected lines.
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Filtering</div>
		</div>
		<div class="card-body maxvw-40">
			To do basic filtering of the records based on field values use the 'filter' command:
			<pre><code class="language-cfwquery">| source random records=10000
| filter 
   LASTNAME ~= ".*son$" 
   AND LIKES_TIRAMISU != false</code></pre>
   		Available Operators: == != &lt;= >= &lt; > ~= AND OR
		</div>
	</div>
	
</div>

<!-- =========================== SECOND ROW ================================= -->
<div class="d-flex flex-row page-break-avoid">

	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Set Field Values</div>
		</div>
		<div class="card-body maxvw-40">
			To set the value of a field or add new fields use the 'set' command. Existing values will be overwritten:
			<pre><code class="language-cfwquery">| source random 
	records=100 
	type=series
| set 
	SQUARE=COUNT*COUNT
	CONCATENATE="Item: "+ITEM</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Removing Fields</div>
		</div>
		<div class="card-body maxvw-40">
			Use 'remove' command to remove some fields:
			<pre><code class="language-cfwquery">| source random 
| remove INDEX, URL</code></pre>
			Use 'keep' command to remove all fields except for the ones to keep:
			<pre><code class="language-cfwquery">| source random 
| keep INDEX, FIRSTNAME</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Sorting</div>
		</div>
		<div class="card-body maxvw-40">
			Sorting records is achieved by using the 'sort' command and providing the fields to sort by:
			<pre><code class="language-cfwquery">| source random records=500
| sort FIRSTNAME, LASTNAME
	reverse=false 
	reversenulls=true</code></pre>
		</div>
	</div>
	
</div>

<!-- =========================== THIRD ROW ================================= -->
<div class="d-flex flex-row page-break-avoid">

	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Unique Values</div>
		</div>
		<div class="card-body maxvw-40">
			You can get unique records using the 'distinct' command. Following gives you unique values by Lastname and Tiramisu preference:
			<pre><code class="language-cfwquery">| source random records=5000
| distinct 
	LASTNAME, LIKES_TIRAMISU
	trim=false 
| sort 
	LASTNAME, LIKES_TIRAMISU</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Statistics</div>
		</div>
		<div class="card-body maxvw-40">
			Use 'stats' command to create statistics for field values. Choose any field with a numerical value to create statistics from:
			<pre><code class="language-cfwquery">| source random records=10000
| stats 
    by=[LASTNAME, LIKES_TIRAMISU] 
    COUNT=count() 
	MIN=min(VALUE) 
	AVG=avg(VALUE) 
	MAX=max(VALUE)
	SUM=sum(VALUE)
	MEDIAN=median(VALUE)
	"90th"=perc(VALUE, 90)	
| sort LASTNAME</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Comments</div>
		</div>
		<div class="card-body maxvw-40">
			You can use hash for line comments or 'comment'/'off' command to make everything until the next pipe a comment:
			<pre><code class="language-cfwquery"># use hash for line comment
| source random records=879
| comment 
	"applies until next pipe"
	"same as off"
| top 20
| off distinct FIRSTNAME | tail 10</code></pre>
		</div>
	</div>
</div>

<!-- ============================================================ -->
<!-- FORMATTING AND DISPLAY -->
<!-- formatfield, formatrecord, display, chart -->
<!-- ============================================================ -->
<h2>Formatting and Display</h2>

<!-- =========================== FIRST ROW ================================= -->
<div class="d-flex flex-row page-break-avoid">

	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Formatting Fields</div>
		</div>
		<div class="card-body maxvw-40">
			Use the 'formatfield' command to define how fields should be formatted.
			Use content assist(Ctrl+spacebar) to get a list of available formatters.
			Following formats the field 'VALUE' to be uppercase and have a prefix 
			and a suffix:
			<pre><code class="language-cfwquery">| source random
| formatfield 
	VALUE=uppercase
	VALUE=[prefix,"Mighty Balance: "]
	VALUE=[postfix," $"]
	</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Grouping Formats</div>
		</div>
		<div class="card-body maxvw-40">
			To apply the same formats to multiple fields, you can use arrays on both sides of the assignment. 
			Following adds a the formatters 'separators' and 'threshold' to the fields 'THOUSANDS,FLOAT,BIG_DECIMAL':
			<pre><code class="language-cfwquery">| source random type=numbers
| formatfield 
	[THOUSANDS,FLOAT,BIG_DECIMAL]=
		[
			 [separators]
			,['threshold'
				, 0
				, 1000
				, 1000^2
				, 1000^3
				, 1000^4
				, "text"
			]
		]</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Case Formatter</div>
		</div>
		<div class="card-body maxvw-40">
			The case formatter allows you to do highly specific formatting based on the fields value.
			The input alternates between a condition and a format. The first condition that matches will cause the format that follows it to be applied:
			<pre><code class="language-cfwquery">| source random type=various
| formatfield 
   STATUS=
   ['case', 
	"Warning", 
		"orange",
	["Excellent", "OR", "Good"], 
		[css, "color", "green"],
	[], # default case 
		[
			[css, "background", "darkred"],
			[css, "color", "white"],
			[css, "border", "5px dotted white"],
			[align, "center"]
		]
    ]</code></pre>
		</div>
	</div>
</div>

<!-- =========================== SECOND ROW ================================= -->
<div class="d-flex flex-row page-break-avoid">

	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Format Record</div>
		</div>
		<div class="card-body maxvw-40">
			Use the command 'formatrecord' to colorize the records based on conditions.
			The following checks the field VALUE and applies the default "cfw" threshold colors
			for the first condition that is matched. Also default formats for LIKES_TIRAMISU and URL 
			are disabled.
			<pre><code class="language-cfwquery">| source random records=1000
| formatrecord 
	[(VALUE >= 80), "cfw-danger"] 
	[(VALUE >= 60), "cfw-emergency"]  
	[(VALUE >= 40), "cfw-warning", "purple"] 
	[(VALUE >= 20), "cfw-good"] 
	[(VALUE >= 10), "cfw-excellent"] 
	[true, "cfw-gray"] 
| formatfield LIKES_TIRAMISU=none URL=none</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Format Record Again</div>
		</div>
		<div class="card-body maxvw-40">
			You can use any css color and hex colors too. Also your conditions can be as complex as you need them to be:
			<pre><code class="language-cfwquery">| source random records=1000
| remove _source
| formatrecord 
	[(FIRSTNAME ~='^He'), "#332288"] 
	[(VALUE >= 80 OR LIKES_TIRAMISU==false), "red"] 
	[(LIKES_TIRAMISU==true), "green"] 
	[true, "cfw-gray"]
| formatfield LIKES_TIRAMISU=none</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Choose Display</div>
		</div>
		<div class="card-body maxvw-40">
			Use the display command to define which renderer to use. You have many options like: table, panels, cards, tiles, statuslist, statusbar, statusbarreverse, statusmap, csv, json, xml.
			<br/>Following query displays the data as panels, while using FIRSTNAME and LASTNAME for the panel header.
			<pre><code class="language-cfwquery">| source random records=100
| remove _source
| display 
	as=panels
	titlefields=[FIRSTNAME, LASTNAME]</code></pre>
		</div>
	</div>
</div>



<!-- =========================== THIRD ROW ================================= -->
<div class="d-flex flex-row page-break-avoid">

	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Display: Tiles</div>
		</div>
		<div class="card-body maxvw-40">
			for displaying as tiles it often makes sense to not have any visible fields.
			This can be achieved thy setting visible fields to an empty array:
			<pre><code class="language-cfwquery">| source random records=100
| display 
	as=tiles 
	menu=false 
	titlefields=[VALUE] 
	visiblefields=[]</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Display: Title Format</div>
		</div>
		<div class="card-body maxvw-40">
			For certain renderers you can specify title fields and a format.
			Use placeholders like {0}, {1}...{n} in a template string to create you7r title format:
			<pre><code class="language-cfwquery">| source random
| display as=panels  
    titlefields=[
    	INDEX
    	, FIRSTNAME
    	, LASTNAME
    ]
    titleformat="{0}: {2} {1}"</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Combine Everything</div>
		</div>
		<div class="card-body maxvw-40">
			You can combine the various formatting commands to get a highly customized view of your data.
			The following will add colors to the records, ads a percentage to the VALUE and displays it as tiles:
			<pre><code class="language-cfwquery">| source random records=100
| formatrecord 
	[(VALUE >= 80), "cfw-danger"] 
	[(VALUE >= 40), "cfw-warning"] 
	[(VALUE >= 0), "cfw-excellent"] 
| sort VALUE reverse=true
| formatfield 
	VALUE=postfix,"%" 
| display 
	as=tiles
	menu=false 
	titlefields=[VALUE] 
	visiblefields=[]</code></pre>
		</div>
	</div>
</div>

<!-- ============================================================ -->
<!-- SYNTAX -->
<!-- Strings, Operators, Functions, Arrays, Json, BinaryExpressions&Groups -->
<!-- ============================================================ -->
<h2>Syntax</h2>

<!-- =========================== FIRST ROW ================================= -->
<div class="d-flex flex-row page-break-avoid">

	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Strings</div>
		</div>
		<div class="card-body maxvw-40">
			All of the following are string in the CFWQL Syntax:
			<pre><code class="language-cfwquery"># Strings
"I'm a string"
'I am another string' 
`String in backticks`
I_am_a_string
We are strings too</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Fieldnames</div>
		</div>
		<div class="card-body maxvw-40">
			Any string that matches a fieldname(case sensitive) will be replaced by the value of that field.
			Following example assigns the value of the field INDEX to 4 other fields. 
			The new field STRING will contain the string 'index' as it does not match the case:
			<pre><code class="language-cfwquery">| source random records=100
| set
	INDEX_A=INDEX
	INDEX_B="INDEX"
	INDEX_C='INDEX'
	INDEX_D=`INDEX`
	STRING=index
	</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Arrays</div>
		</div>
		<div class="card-body maxvw-40">
			Arrays can be represented in two different ways, with square braces and without. You can access an array value using an index in square braces:
			<pre><code class="language-cfwquery">| source random type=numbers records=3
| set
	ARRAY_A=1,2,3,5,6
	ARRAY_B=["a","b","c",true,42]
	ARRAY_C=[ [a,b,c], [1,2,3]  ]
	# returns array [1,2,3]
	# will finally be [1,"X",3]
	ARRAY_SUB=ARRAY_C[1]
	# clone will not be modified
	CLONE=clone(ARRAY_C[1])
	SUBVALUE=ARRAY_C[1][1] 	# returns "2"
	ARRAY_C[1][1]="X" # override "2" with "X"</code></pre>
		</div>
	</div>
</div>

<!-- =========================== FIRST ROW ================================= -->
<div class="d-flex flex-row page-break-avoid">


	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>Accessing Object Data</div>
		</div>
		<div class="card-body maxvw-40">
			The processed data can contain JSON objects. To access the data in these objects you can use the dot operator '.' like follows:
			<pre><code class="language-cfwquery">| source random type=various records=10
| keep GRAPH_DATA
| set
	X=GRAPH_DATA.x
	Y=GRAPH_DATA.y
	GRAPH_DATA_CLONE=clone(GRAPH_DATA)
	GRAPH_DATA.rounded.x=round(GRAPH_DATA.x,2)
	GRAPH_DATA.rounded.y=round(GRAPH_DATA.y,2)
| filter 
	GRAPH_DATA.rounded.x &lt;= 5</code></pre>
		</div>
	</div>
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>xxx</div>
		</div>
		<div class="card-body maxvw-40">
			:
			<pre><code class="language-cfwquery"></code></pre>
		</div>
	</div>
	
	
	<div class="card flex-grow-1">
		<div class="card-header pt-1 pb-1">
			<div>xxx</div>
		</div>
		<div class="card-body maxvw-40">
			:
			<pre><code class="language-cfwquery"></code></pre>
		</div>
	</div>
</div>




	