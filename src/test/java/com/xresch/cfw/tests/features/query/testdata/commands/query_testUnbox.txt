| source json data=`[
{product="Table", 
	properties: { legs:{ count: 4, length: 80}, lengthUnit: "cm" }, 
	costs: {
		dollaresPerCM: 0.2, 
		sellerFees: [
			{seller: "Super Market", feeUSD: 30},
			{seller: "Jane's Furniture", feeUSD: 50},
			{seller: "Mega Store", feeUSD: 25} ]
}},
{product="Chair", 
	properties: { legs:{ count: 4, length: 50}, lengthUnit: "cm" }, 
	costs: {
		dollaresPerCM: 0.1, 
		sellerFees: [
			{seller: "Super Market", feeUSD: 25},
			{seller: "Jane's Furniture", feeUSD: 37},
			{seller: "Mega Store", feeUSD: 55} ]
}}
]`
| unbox 
	replace=true # remove existing fields
	product                # keep product field
	properties.legs.count  # unboxed to count 
	properties.legs.length # unboxed to length
	costs.dollaresPerCM    # unboxed to dollaresPerCM
	costs.sellerFees       # unbox array of objects
| unbox
	sellerFees # unbox the previously unboxed objects
| remove sellerFees
| set totalCostUSD = (count * length * dollaresPerCM) + feeUSD
| formatfield totalCostUSD=[
	['threshold', 0, 60, 70, 80, 90, "bg"]
	, ['align', "right"]
	, ['postfix', " USD"]
]